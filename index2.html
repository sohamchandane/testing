<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smartwatch BLE Scanner</title>
</head>
<body>
    <h2>Smartwatch Bluetooth Scanner</h2>
    <button onclick="connectSmartwatch()">Scan & Connect</button>

    <script>
        async function connectSmartwatch() {
            try {
                console.log("Scanning for Bluetooth devices...");
                
                // Step 1: Let user select a smartwatch
                const device = await navigator.bluetooth.requestDevice({
                    acceptAllDevices: true,
                    optionalServices: ['generic_access'] // Allows listing all services
                });

                console.log("Selected device:", device.name || "Unnamed Device");

                // Step 2: Connect to the smartwatch
                const server = await device.gatt.connect();
                console.log("Connected to", device.name);

                // Step 3: Get all available services
                const services = await server.getPrimaryServices();
                console.log("Available Services:");

            //     let heartRateChar = null;
            //     let spo2Char = null;

            //     for (const service of services) {
            //         console.log(`- Service UUID: ${service.uuid}`);

            //         // Step 4: Get characteristics for each service
            //         const characteristics = await service.getCharacteristics();
            //         for (const characteristic of characteristics) {
            //             console.log(`  â†’ Characteristic UUID: ${characteristic.uuid}`);

            //             // Check if it's Heart Rate (0x2A37) or SpO2 (0x2A5F)
            //             if (characteristic.uuid === '00002a37-0000-1000-8000-00805f9b34fb') {
            //                 heartRateChar = characteristic;
            //             } else if (characteristic.uuid === '00002a5f-0000-1000-8000-00805f9b34fb') {
            //                 spo2Char = characteristic;
            //             }
            //         }
            //     }

            //     // Step 5: Read real-time Heart Rate if available
            //     if (heartRateChar) {
            //         console.log("Subscribing to Heart Rate notifications...");
            //         heartRateChar.addEventListener('characteristicvaluechanged', event => {
            //             const value = event.target.value;
            //             const heartRate = value.getUint8(1);
            //             console.log("Heart Rate:", heartRate, "bpm");
            //         });
            //         await heartRateChar.startNotifications();
            //     } else {
            //         console.log("Heart Rate characteristic not found.");
            //     }

            //     // Step 6: Read real-time SpO2 if available
            //     if (spo2Char) {
            //         console.log("Subscribing to SpO2 notifications...");
            //         spo2Char.addEventListener('characteristicvaluechanged', event => {
            //             const value = event.target.value;
            //             const spo2 = value.getUint8(1);
            //             console.log("SpO2 Level:", spo2, "%");
            //         });
            //         await spo2Char.startNotifications();
            //     } else {
            //         console.log("SpO2 characteristic not found.");
            //     }

            } catch (error) {
                console.error("Error:", error);
            }
        }
    </script>
</body>
</html>