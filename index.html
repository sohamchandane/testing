<button id="connect">Connect Smartwatch</button>
<pre id="log"></pre>

<script>
const logEl = document.getElementById('log');
function log(msg) {
  logEl.textContent += `[${new Date().toLocaleTimeString()}] ${msg}\n`;
  logEl.scrollTop = logEl.scrollHeight;
}

async function connectDevice() {
  try {
    const device = await navigator.bluetooth.requestDevice({
      acceptAllDevices: true,
      optionalServices: [] // We'll discover all
    });
    log(`Selected device: ${device.name || device.id}`);

    const server = await device.gatt.connect();
    log('Connected.');

    const services = await server.getPrimaryServices();
    log(`Found ${services.length} services.`);

    for (const service of services) {
      log(`Service: ${service.uuid}`);
      const characteristics = await service.getCharacteristics();
      for (const char of characteristics) {
        const props = Object.entries(char.properties).filter(([k,v])=>v).map(([k])=>k).join(',');
        log(`  Char: ${char.uuid} props: ${props}`);
        if (char.properties.notify) {
          await char.startNotifications();
          char.addEventListener('characteristicvaluechanged', (event) => {
            const raw = new Uint8Array(event.target.value.buffer);
            log(`  Notification from ${char.uuid}: [${Array.from(raw).join(', ')}]`);
          });
          log(`  Subscribed to ${char.uuid}`);
        }
      }
    }
  } catch (err) {
    log(`Error: ${err.message}`);
  }
}

document.getElementById('connect').addEventListener('click', connectDevice);
</script>
