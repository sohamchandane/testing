<button id="connect">Connect Smartwatch</button>
<pre id="log"></pre>

<script>
const logEl = document.getElementById('log');
function log(msg) {
  logEl.textContent += `[${new Date().toLocaleTimeString()}] ${msg}\n`;
  logEl.scrollTop = logEl.scrollHeight;
}

async function connectDevice() {
  try {
    const device = await navigator.bluetooth.requestDevice({
      acceptAllDevices: true,
      optionalServices: [] // Try to discover everything
    });
    log(`Selected device: ${device.name || device.id}`);

    const server = await device.gatt.connect();
    log('Connected.');

    const services = await server.getPrimaryServices();
    if (!services.length) {
      log("‚ö† No services found ‚Äî device may be idle, require pairing, or not BLE.");
      return;
    }
    log(`Found ${services.length} services.`);

    for (const service of services) {
      log(`üîπ Service: ${service.uuid}`);
      const characteristics = await service.getCharacteristics();

      for (const char of characteristics) {
        const props = Object.entries(char.properties)
          .filter(([k, v]) => v)
          .map(([k]) => k)
          .join(',');
        log(`  ‚û§ Char: ${char.uuid} props: ${props}`);

        // Try reading if possible
        if (char.properties.read) {
          try {
            const val = await char.readValue();
            const raw = new Uint8Array(val.buffer);
            log(`    üìñ Read: [${Array.from(raw).join(', ')}]`);
          } catch (err) {
            log(`    ‚ùå Read failed: ${err.message}`);
          }
        }

        // Subscribe if possible
        if (char.properties.notify || char.properties.indicate) {
          try {
            await char.startNotifications();
            char.addEventListener('characteristicvaluechanged', e => {
              const raw = new Uint8Array(e.target.value.buffer);
              log(`    üîî Notify: [${Array.from(raw).join(', ')}]`);
            });
            log(`    ‚úÖ Subscribed for notifications`);
          } catch (err) {
            log(`    ‚ùå Notify failed: ${err.message}`);
          }
        }
      }
    }
  } catch (err) {
    log(`Error: ${err.message}`);
  }
}

document.getElementById('connect').addEventListener('click', connectDevice);
</script>
